let schedule = {};
let currentFloor = '';

const weekdayNames = ['일', '월', '화', '수', '목', '금'];

// 월~금 모두 CSV 문자열로 데이터 저장
const csvData = {
  '월': `
시간,강의실
9:00,305
9:00,308
9:30,305
9:30,308
10:00,305
10:00,308
10:30,103
10:30,303
10:30,305
10:30,306
10:30,308
10:30,503
11:00,103
11:00,303
11:00,305
11:00,306
11:00,308
11:00,503
11:30,103
11:30,303
11:30,305
11:30,306
11:30,308
11:30,503
12:00,103
12:00,301
12:00,303
12:00,305
12:00,306
12:00,308
12:00,402
12:00,501
12:00,503
12:00,507
12:30,103
12:30,301
12:30,303
12:30,305
12:30,306
12:30,308
12:30,402
12:30,501
12:30,503
12:30,507
13:00,103
13:00,301
13:00,303
13:00,305
13:00,306
13:00,308
13:00,402
13:00,501
13:00,503
13:00,507
13:30,102
13:30,103
13:30,104
13:30,105
13:30,107
13:30,307
13:30,308
13:30,402
13:30,403
13:30,404
13:30,406
13:30,407
13:30,501
13:30,505
14:00,102
14:00,103
14:00,104
14:00,105
14:00,307
14:00,308
14:00,401
14:00,402
14:00,403
14:00,404
14:00,406
14:00,407
14:00,501
14:00,505
14:30,102
14:30,103
14:30,104
14:30,105
14:30,107
14:30,307
14:30,308
14:30,401
14:30,402
14:30,403
14:30,404
14:30,406
14:30,407
14:30,501
14:30,505
15:00,101
15:00,103
15:00,104
15:00,105
15:00,106
15:00,107
15:00,301
15:00,303
15:00,305
15:00,306
15:00,307
15:00,308
15:00,402
15:00,403
15:00,406
15:00,407
15:00,501
15:00,502
15:00,504
15:00,505
15:00,506
15:00,407
15:30,101
15:30,103
15:30,104
15:30,105
15:30,106
15:30,107
15:30,301
15:30,303
15:30,305
15:30,306
15:30,307
15:30,308
15:30,402
15:30,403
15:30,404
15:30,406
15:30,407
15:30,501
15:30,502
15:30,504
15:30,506
15:30,507
16:00,101
16:00,103
16:00,104
16:00,105
16:00,106
16:00,107
16:00,301
16:00,303
16:00,305
16:00,306
16:00,307
16:00,308
16:00,402
16:00,403
16:00,404
16:00,406
16:00,407
16:00,501
16:00,502
16:00,504
16:00,505
16:00,506
16:00,507
16:30,101
16:30,106
16:30,203
16:30,303
16:30,305
16:30,306
16:30,401
16:30,403
16:30,406
16:30,501
16:30,502
16:30,504
16:30,505
17:00,101
17:00,106
17:00,203
17:00,303
17:00,305
17:00,306
17:00,401
17:00,402
17:00,406
17:00,501
17:00,504
17:00,505
17:30,101
17:30,106
17:30,203
17:30,303
17:30,305
17:30,306
17:30,401
17:30,402
17:30,406
17:30,501
17:30,504
17:30,505
18:00,101
18:00,102
18:00,103
18:00,106
18:00,107
18:00,203
18:00,302
18:00,305
18:00,306
18:00,308
18:00,402
18:00,406
18:00,503
18:00,504
18:00,505
18:00,506
18:30,101
18:30,102
18:30,103
18:30,106
18:30,107
18:30,203
18:30,302
18:30,305
18:30,306
18:30,308
18:30,402
18:30,406
18:30,503
18:30,504
18:30,505
18:30,506
19:00,101
19:00,102
19:00,103
19:00,106
19:00,107
19:00,302
19:00,305
19:00,306
19:00,308
19:00,402
19:00,406
19:00,503
19:00,504
19:00,505
19:00,506
19:30,101
19:30,102
19:30,106
19:30,301
19:30,302
19:30,305
19:30,306
19:30,503
19:30,504
20:00,101
20:00,102
20:00,106
20:00,301
20:00,302
20:00,306
20:00,503
20:00,504
20:30,101
20:30,102
20:30,106
20:30,301
20:30,302
20:30,306
20:30,503
20:30,504
21:00,403
21:00,406
21:30,403
21:30,406
22:00,
`,
  '화': `
시간,강의실
9:00,103
9:00,308
9:00,402
9:00,403
9:00,404
9:00,406
9:30,103
9:30,308
9:30,402
9:30,403
9:30,404
9:30,406
10:00,103
10:00,203
10:00,205
10:00,301
10:00,305
10:00,308
10:00,402
10:00,403
10:00,404
10:00,406
10:00,504
10:30,103
10:30,203
10:30,205
10:30,301
10:30,305
10:30,308
10:30,402
10:30,403
10:30,404
10:30,406
10:30,504
11:00,103
11:00,203
11:00,301
11:00,302
11:00,305
11:00,307
11:00,308
11:00,402
11:00,403
11:00,404
11:00,406
11:00,501
11:00,504
11:30,103
11:30,203
11:30,301
11:30,302
11:30,305
11:30,307
11:30,308
11:30,402
11:30,403
11:30,404
11:30,406
11:30,501
11:30,504
12:00,301
12:00,302
12:00,307
12:00,308
12:00,402
12:00,403
12:00,404
12:30,301
12:30,302
12:30,308
12:30,402
12:30,403
12:30,404
13:00,102
13:00,103
13:00,104
13:00,105
13:00,203
13:00,205
13:00,302
13:00,308
13:00,402
13:00,403
13:00,404
13:00,505
13:30,102
13:30,103
13:30,104
13:30,105
13:30,203
13:30,205
13:30,302
13:30,308
13:30,402
13:30,403
13:30,404
13:30,505
14:00,102
14:00,103
14:00,105
14:00,203
14:00,205
14:00,303
14:00,305
14:00,308
14:00,403
14:00,404
14:00,505
14:30,102
14:30,103
14:30,105
14:30,203
14:30,205
14:30,303
14:30,305
14:30,308
14:30,403
14:30,404
14:30,505
15:00,101
15:00,102
15:00,103
15:00,104
15:00,105
15:00,203
15:00,205
15:00,302
15:00,303
15:00,305
15:00,306
15:00,401
15:00,502
15:00,504
15:30,101
15:30,102
15:30,103
15:30,104
15:30,105
15:30,203
15:30,205
15:30,302
15:30,303
15:30,305
15:30,306
15:30,401
15:30,502
15:30,504
16:00,101
16:00,104
16:00,105
16:00,106
16:00,107
16:00,203
16:00,205
16:00,301
16:00,302
16:00,303
16:00,305
16:00,306
16:00,401
16:00,501
16:00,502
16:00,504
16:30,101
16:30,104
16:30,105
16:30,106
16:30,107
16:30,203
16:30,205
16:30,301
16:30,302
16:30,303
16:30,305
16:30,306
16:30,401
16:30,501
16:30,502
16:30,504
17:00,104
17:00,105
17:00,106
17:00,107
17:00,203
17:00,301
17:00,302
17:00,303
17:00,305
17:00,306
17:00,501
17:00,502
17:00,505
17:30,104
17:30,105
17:30,106
17:30,107
17:30,203
17:30,301
17:30,302
17:30,303
17:30,305
17:30,306
17:30,501
17:30,502
17:30,505
18:00,101
18:00,102
18:00,103
18:00,104
18:00,105
18:00,106
18:00,107
18:00,203
18:00,205
18:00,303
18:00,307
18:00,308
18:00,401
18:00,403
18:00,404
18:00,405
18:00,406
18:00,407
18:00,501
18:00,502
18:30,101
18:30,102
18:30,103
18:30,104
18:30,105
18:30,106
18:30,107
18:30,203
18:30,205
18:30,303
18:30,307
18:30,308
18:30,401
18:30,403
18:30,404
18:30,405
18:30,406
18:30,407
18:30,501
18:30,502
19:00,102
19:00,103
19:00,104
19:00,105
19:00,107
19:00,203
19:00,205
19:00,307
19:00,308
19:00,403
19:00,404
19:00,405
19:00,406
19:00,407
19:00,502
19:30,102
19:30,103
19:30,104
19:30,105
19:30,107
19:30,203
19:30,205
19:30,307
19:30,308
19:30,403
19:30,404
19:30,405
19:30,406
19:30,407
19:30,502
20:00,102
20:00,103
20:00,104
20:00,107
20:00,308
20:00,403
20:00,404
20:00,405
20:00,406
20:00,407
20:00,502
20:30,102
20:30,103
20:30,104
20:30,107
20:30,308
20:30,403
20:30,404
20:30,405
20:30,406
20:30,407
21:00,
21:30,
22:00,

`,
  '수': `
시간,강의실
9:00,103
9:30,103
10:00,103
10:30,103
10:30,105
10:30,301
10:30,307
10:30,402
10:30,403
10:30,404
10:30,406
10:30,407
10:30,501
10:30,502
11:00,103
11:00,105
11:00,301
11:00,307
11:00,402
11:00,403
11:00,404
11:00,406
11:00,407
11:00,501
11:00,502
11:30,103
11:30,105
11:30,301
11:30,307
11:30,402
11:30,403
11:30,404
11:30,406
11:30,407
11:30,501
11:30,502
12:00,101
12:00,103
12:00,307
12:00,402
12:00,403
12:00,404
12:00,406
12:00,407
12:00,501
12:00,502
12:30,101
12:30,103
12:30,307
12:30,402
12:30,403
12:30,404
12:30,406
12:30,407
12:30,501
12:30,502
13:00,101
13:00,103
13:00,307
13:00,402
13:00,403
13:00,404
13:00,406
13:00,407
13:00,501
13:00,502
13:30,101
13:30,103
13:30,105
13:30,107
13:30,301
13:30,303
13:30,305
13:30,307
13:30,308
13:30,401
13:30,402
13:30,406
13:30,407
13:30,501
13:30,503
13:30,504
13:30,505
13:30,506
14:00,101
13:30,103
13:30,105
13:30,107
13:30,301
13:30,303
13:30,305
13:30,307
13:30,308
13:30,401
13:30,402
13:30,406
13:30,407
13:30,501
13:30,503
13:30,504
13:30,505
13:30,506
14:30,101
14:30,103
14:30,105
14:30,107
14:30,301
14:30,303
14:30,305
14:30,307
14:30,308
14:30,401
14:30,402
14:30,406
14:30,407
14:30,501
14:30,503
14:30,504
14:30,505
14:30,506
15:00,101
15:00,103
15:00,104
15:00,106
15:00,107
15:00,301
15:00,303
15:00,305
15:00,307
15:00,308
15:00,402
15:00,403
15:00,404
15:00,405
15:00,406
15:00,407
15:00,501
15:00,503
15:00,504
15:00,505
15:00,506
15:30,101
15:30,103
15:30,104
15:30,106
15:30,107
15:30,301
15:30,303
15:30,305
15:30,307
15:30,308
15:30,402
15:30,403
15:30,404
15:30,405
15:30,406
15:30,407
15:30,501
15:30,503
15:30,504
15:30,505
15:30,506
16:00,101
16:00,103
16:00,104
16:00,106
16:00,107
16:00,301
16:00,303
16:00,305
16:00,307
16:00,308
16:00,402
16:00,403
16:00,404
16:00,405
16:00,406
16:00,407
16:00,501
16:00,503
16:00,504
16:00,505
16:00,506
16:30,101
16:30,104
16:30,106
16:30,301
16:30,303
16:30,305
16:30,401
16:30,404
16:30,406
16:30,407
16:30,503
17:00,101
17:00,104
17:00,106
17:00,301
17:00,303
17:00,305
17:00,401
17:00,404
17:00,406
17:00,407
17:00,503
17:30,101
17:30,104
17:30,106
17:30,301
17:30,303
17:30,305
17:30,401
17:30,404
17:30,406
17:30,407
17:30,503
18:00,101
18:00,103
18:00,105
18:00,106
18:00,107
18:00,203
18:00,205
18:00,301
18:00,303
18:00,305
18:00,307
18:00,308
18:00,401
18:00,402
18:00,403
18:00,406
18:00,407
18:00,503
18:30,101
18:30,103
18:30,105
18:30,106
18:30,107
18:30,203
18:30,205
18:30,301
18:30,303
18:30,305
18:30,307
18:30,308
18:30,401
18:30,402
18:30,403
18:30,406
18:30,407
18:30,503
19:00,101
19:00,103
19:00,105
19:00,106
19:00,107
19:00,203
19:00,205
19:00,301
19:00,303
19:00,305
19:00,307
19:00,308
19:00,401
19:00,402
19:00,403
19:00,406
19:00,407
19:00,503
19:30,101
19:30,103
19:30,105
19:30,106
19:30,107
19:30,203
19:30,301
19:30,303
19:30,307
19:30,308
19:30,401
19:30,402
19:30,403
19:30,404
19:30,405
19:30,406
19:30,407
19:30,502
19:30,503
20:00,101
20:00,103
20:00,105
20:00,106
20:00,107
20:00,301
20:00,303
20:00,307
20:00,308
20:00,401
20:00,402
20:00,403
20:00,404
20:00,405
20:00,502
20:00,503
20:30,101
20:30,103
20:30,105
20:30,16
20:30,107
20:30,301
20:30,303
20:30,308
20:30,401
20:30,402
20:30,403
20:30,404
20:30,405
20:30,502
20:30,503
21:00,102
21:00,305
21:30,102
21:30,305
22:00,

`,
  '목': `
시간,강의실
9:00,308
9:30,308
10:00,308
10:30,103
10:30,105
10:30,303
10:30,305
10:30,308
10:30,401
10:30,402
11:00,103
11:00,105
11:00,303
11:00,305
11:00,308
11:00,401
11:00,402
11:30,103
11:30,105
11:30,303
11:30,305
11:30,308
11:30,401
11:30,402
12:00,103
12:00,203
12:00,305
12:00,306
12:00,308
12:00,401
12:00,402
12:00,501
12:00,503
12:30,103
12:30,203
12:30,305
12:30,306
12:30,308
12:30,401
12:30,402
12:30,501
12:30,503
13:00,103
13:00,203
13:00,305
13:00,306
13:00,308
13:00,401
13:00,402
13:00,501
13:00,503
13:30,103
13:30,105
13:30,107
13:30,203
13:30,301
13:30,302
13:30,303
13:30,305
13:30,306
13:30,307
13:30,308
13:30,401
13:30,402
13:30,403
13:30,501
13:30,504
13:30,505
13:30,508
14:00,103
14:00,105
14:00,107
14:00,203
14:00,301
14:00,302
14:00,303
14:00,305
14:00,306
14:00,307
14:00,308
14:00,401
14:00,402
14:00,403
14:00,501
14:00,504
14:00,505
14:00,508
14:30,103
14:30,105
14:30,107
14:30,203
14:30,301
14:30,302
14:30,303
14:30,305
14:30,306
14:30,307
14:30,308
14:30,401
14:30,402
14:30,403
14:30,501
14:30,504
14:30,505
14:30,508
15:00,101
15:00,103
15:00,105
15:00,106
15:00,107
15:00,203
15:00,301
15:00,302
15:00,303
15:00,305
15:00,306
15:00,307
15:00,308
15:00,401
15:00,402
15:00,403
15:00,405
15:00,406
15:00,407
15:00,501
15:00,502
15:00,504
15:00,505
15:00,506
15:30,101
15:30,103
15:30,105
15:30,106
15:30,107
15:30,203
15:30,301
15:30,302
15:30,303
15:30,305
15:30,306
15:30,307
15:30,308
15:30,401
15:30,402
15:30,403
15:30,405
15:30,406
15:30,407
15:30,501
15:30,502
15:30,504
15:30,505
15:30,506
16:00,101
16:00,103
16:00,105
16:00,106
16:00,107
16:00,203
16:00,301
16:00,302
16:00,303
16:00,305
16:00,306
16:00,307
16:00,308
16:00,401
16:00,402
16:00,403
16:00,405
16:00,406
16:00,407
16:00,501
16:00,502
16:00,504
16:00,505
16:00,506
16:30,101
16:30,105
16:30,106
16:30,107
16:30,203
16:30,301
16:30,302
16:30,303
16:30,308
16:30,402
16:30,403
16:30,406
16:30,502
16:30,505
17:00,101
17:00,105
17:00,106
17:00,107
17:00,203
17:00,301
17:00,302
17:00,303
17:00,308
17:00,402
17:00,403
17:00,406
17:00,502
17:00,505
17:30,101
17:30,105
17:30,106
17:30,107
17:30,203
17:30,301
17:30,302
17:30,303
17:30,308
17:30,402
17:30,403
17:30,406
17:30,502
17:30,505
18:00,102
18:00,103
18:00,105
18:00,107
18:00,302
18:00,303
18:00,305
18:00,307
18:00,308
18:00,401
18:00,402
18:00,403
18:00,404
18:00,405
18:00,407
18:00,505
18:30,102
18:30,103
18:30,107
18:30,302
18:30,303
18:30,305
18:30,308
18:30,401
18:30,402
18:30,403
18:30,404
18:30,405
18:30,407
18:30,505
19:00,102
19:00,103
19:00,107
19:00,303
19:00,305
19:00,307
19:00,308
19:00,401
19:00,402
19:00,403
19:00,404
19:00,405
19:00,407
19:00,505
19:30,102
19:30,103
19:30,307
19:30,308
19:30,402
19:30,403
19:30,404
19:30,505
20:00,102
20:00,103
20:00,307
20:00,308
20:00,403
20:00,404
20:00,505
20:30,102
20:30,103
20:30,307
20:30,308
20:30,402
20:30,403
20:30,404
20:30,505
21:00,402
21:00,403
21:00,404
21:00,505
21:30,402
21:30,403
21:30,404
21:30,505
22:00,


`,
  '금': `
시간,강의실
9:00,402
9:00,403
9:00,404
9:00,406
9:30,402
9:30,403
9:30,404
9:30,406
10:00,104
10:00,203
10:00,402
10:00,403
10:00,404
10:00,406
10:30,104
10:30,203
10:30,402
10:30,403
10:30,404
10:30,406
11:00,104
11:00,203
11:00,307
11:00,402
11:00,403
11:00,404
11:00,406
11:30,104
11:30,203
11:30,307
11:30,402
11:30,403
11:30,404
11:30,406
12:00,104
12:00,203
12:00,307
12:00,402
12:00,403
12:00,404
12:30,104
12:30,203
12:30,307
12:30,402
12:30,403
12:30,404
13:00,102
13:00,103
13:00,104
13:00,203
13:00,305
13:00,307
13:00,308
13:00,402
13:00,403
13:00,404
13:30,102
13:30,103
13:30,104
13:30,203
13:30,305
13:30,307
13:30,308
13:30,402
13:30,403
13:30,404
14:00,101
14:00,102
14:00,103
14:00,104
14:00,204
14:00,305
14:00,308
14:00,402
14:00,404
14:30,101
14:30,102
14:30,103
14:30,104
14:30,204
14:30,305
14:30,308
14:30,402
14:30,404
15:00,101
15:00,102
15:00,103
15:00,201
15:00,204
15:00,205
15:00,305
15:00,308
15:30,101
15:30,102
15:30,103
15:30,201
15:30,204
15:30,205
15:30,305
15:30,308
16:00,101
16:00,102
16:00,201
16:00,203
16:00,204
16:00,205
16:30,101
16:30,102
16:30,201
16:30,203
16:30,204
16:30,205
17:00,101
17:00,102
17:00,104
17:00,203
17:30,102
17:30,104
17:30,203
18:00,102
18:00,104
18:00,203
18:00,204
18:00,402
18:00,404
18:00,406
18:00,407
18:30,102
18:30,104
18:30,203
18:30,204
18:30,402
18:30,404
18:30,406
18:30,407
19:00,102
19:00,402
19:00,404
19:00,406
19:00,407
19:30,102
19:30,402
19:30,404
19:30,406
19:30,407
20:00,102
20:00,402
20:00,404
20:00,406
20:00,407
20:30,402
20:30,404
20:30,406
20:30,407
21:00,
21:30,
22:00,

`,
};

function getCurrentTimeSlotFromDate(date) {
  const hour = date.getHours().toString().padStart(2, '0');
  const minute = date.getMinutes() < 30 ? '00' : '30';
  return `${hour}:${minute}`;
}

function updateCurrentTime() {
  const now = new Date();

  const h = now.getHours().toString().padStart(2, '0');
  const m = now.getMinutes().toString().padStart(2, '0');
  const day = weekdayNames[now.getDay()];
  const time = getCurrentTimeSlotFromDate(now);

  document.getElementById('current-time').innerText = `현재시간 : ${h}:${m} (${day}요일)`;

  loadSchedule(day).then(() => {
    showFloor(currentFloor, day, time);
  });
}

function loadSchedule(day) {
  if (!schedule[day]) schedule[day] = {};
  return new Promise((resolve) => {
    const csv = csvData[day];
    if (!csv) {
      resolve();
      return;
    }
    const lines = csv.trim().split('\n').slice(1); // 헤더 제외
    lines.forEach(line => {
      const [timeRaw, roomRaw] = line.split(',');
      const [hour, minute] = timeRaw.split(':');
      const time = `${hour.padStart(2, '0')}:${minute}`;
      const room = roomRaw.trim();

      if (!schedule[day][time]) schedule[day][time] = [];
      schedule[day][time].push(room);
    });
    resolve();
  });
}

function showFloor(floor, day, time) {
  currentFloor = floor;
  const rooms = floorMap[floor] || [];
  const occupied = (schedule[day] && schedule[day][time]) ? schedule[day][time] : [];

  const container = document.getElementById('room-container');
  container.innerHTML = '';
  rooms.forEach(room => {
    const div = document.createElement('div');
    div.className = 'room-box ' + (occupied.includes(room) ? 'occupied' : 'available');
    div.innerText = room;
    container.appendChild(div);
  });

  document.getElementById('floorDisplay').innerText = `${floor} 강의실`;
}

function handleFloorClick(floor) {
  const now = new Date();
  now.setHours(15); // 테스트용 시간 고정
  now.setMinutes(0);
  const day = weekdayNames[now.getDay()];
  const time = getCurrentTimeSlotFromDate(now);

  currentFloor = floor;

  if (schedule[day]) {
    showFloor(floor, day, time);
  } else {
    loadSchedule(day).then(() => {
      showFloor(floor, day, time);
    });
  }
}

const floorMap = {
  '1F': ['102','103','104','105','106','107'],
  '2F': ['201','203','204','205'],
  '3F': ['301','302','303','305','306','307','308'],
  '4F': ['401','402','403','404','405','406','407'],
  '5F': ['501','502','503','504','505','506','507'],
};

// 최초 실행 및 1분마다 갱신
updateCurrentTime();
setInterval(updateCurrentTime, 60000);
